{% extends "base.html" %}

{% block title %}Analýza témat - Czech News Scraper{% endblock %}

{% block content %}
<div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-4">Analýza témat a zdrojů</h2>
    <p class="text-gray-600 mb-6">Porovnejte jak různé zpravodajské servery píší o konkrétních tématech</p>

    <!-- Topic Analysis Form -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <form id="topic-analysis-form" class="space-y-4">
            <div>
                <label for="topic-query" class="block text-sm font-medium text-gray-700 mb-2">
                    Téma pro analýzu
                </label>
                <input type="text" id="topic-query" name="topic"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="Např: rusko, volby, covid, evropska unie">
            </div>

            <button type="submit"
                class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-200"
                hx-get="/search/analyze" hx-target="#analysis-results" hx-include="[name='topic']"
                hx-indicator="#analysis-loading">
                <span class="flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                        </path>
                    </svg>
                    Analyzovat téma
                </span>
            </button>
        </form>

        <!-- Loading Indicator -->
        <div id="analysis-loading" class="htmx-indicator mt-4">
            <div class="flex items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"></div>
                <span class="ml-2 text-gray-600">Analyzujem téma...</span>
            </div>
        </div>
    </div>

    <!-- Quick Topic Examples -->
    <div class="bg-green-50 rounded-lg p-4 mb-6">
        <h3 class="text-lg font-semibold text-green-800 mb-2">Populární témata pro analýzu:</h3>
        <div class="flex flex-wrap gap-2">
            <button class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200 transition"
                onclick="analyzeTopic('rusko')">
                Rusko
            </button>
            <button class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200 transition"
                onclick="analyzeTopic('volby')">
                Volby
            </button>
            <button class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200 transition"
                onclick="analyzeTopic('evropska unie')">
                Evropská unie
            </button>
            <button class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200 transition"
                onclick="analyzeTopic('ekonomika')">
                Ekonomika
            </button>
            <button class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm hover:bg-green-200 transition"
                onclick="analyzeTopic('covid')">
                COVID
            </button>
        </div>
    </div>

    <!-- Analysis Results -->
    <div id="analysis-results" class="space-y-6">
        <div class="text-center text-gray-500 py-8">
            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                </path>
            </svg>
            <p>Vyberte téma pro zobrazení analýzy pokrytí různými zdroji</p>
        </div>
    </div>

    <!-- Semantic Similarity Tool -->
    <div class="bg-white rounded-lg shadow-md p-6 mt-8">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Porovnání sémantické podobnosti textů</h3>
        <p class="text-gray-600 mb-4">Zjistěte jak podobné si jsou dva texty podle významu</p>

        <form id="similarity-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="text1" class="block text-sm font-medium text-gray-700 mb-2">
                        První text
                    </label>
                    <textarea id="text1" name="text1" rows="4"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Vložte první text pro porovnání..."></textarea>
                </div>

                <div>
                    <label for="text2" class="block text-sm font-medium text-gray-700 mb-2">
                        Druhý text
                    </label>
                    <textarea id="text2" name="text2" rows="4"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Vložte druhý text pro porovnání..."></textarea>
                </div>
            </div>

            <button type="submit"
                class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition duration-200"
                hx-post="/search/semantic-similarity" hx-target="#similarity-results" hx-include="#similarity-form"
                hx-indicator="#similarity-loading">
                Porovnat podobnost
            </button>
        </form>

        <!-- Similarity Loading -->
        <div id="similarity-loading" class="htmx-indicator mt-4">
            <div class="flex items-center justify-center">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
                <span class="ml-2 text-gray-600">Počítám podobnost...</span>
            </div>
        </div>

        <!-- Similarity Results -->
        <div id="similarity-results" class="mt-4"></div>
    </div>
</div>

<script>
    function analyzeTopic(topic) {
        document.getElementById('topic-query').value = topic;
        htmx.trigger('#topic-analysis-form button[type="submit"]', 'click');
    }

    // Handle topic analysis form submission
    document.getElementById('topic-analysis-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const topic = document.getElementById('topic-query').value;
        if (topic.trim()) {
            htmx.ajax('GET', `/search/analyze/${encodeURIComponent(topic)}`, {
                target: '#analysis-results',
                indicator: '#analysis-loading'
            });
        }
    });

    // Handle similarity form submission  
    document.getElementById('similarity-form').addEventListener('submit', function (e) {
        e.preventDefault();
    });
</script>

<!-- Custom styles for charts and analysis -->
<style>
    .sentiment-positive {
        @apply bg-green-100 text-green-800;
    }

    .sentiment-negative {
        @apply bg-red-100 text-red-800;
    }

    .sentiment-neutral {
        @apply bg-gray-100 text-gray-800;
    }

    .chart-bar {
        transition: all 0.3s ease;
    }

    .chart-bar:hover {
        opacity: 0.8;
    }
</style>
{% endblock %}