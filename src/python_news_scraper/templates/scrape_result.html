<!-- Scrape Result -->
<div
    class="mt-4 p-4 {% if success %}bg-green-50 border border-green-200{% else %}bg-red-50 border border-red-200{% endif %}">
    <div class="flex">
        <div class="flex-shrink-0">
            {% if success %}
            <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd" />
            </svg>
            {% else %}
            <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                    clip-rule="evenodd" />
            </svg>
            {% endif %}
        </div>
        <div class="ml-3">
            <p class="text-sm {% if success %}text-green-800{% else %}text-red-800{% endif %} font-medium">
                {{ message }}
            </p>
            {% if success and task_id %}
            <p class="text-sm {% if success %}text-green-700{% else %}text-red-700{% endif %} mt-1">
                Task ID: <code class="bg-gray-100 px-1 rounded">{{ task_id }}</code>
            </p>
            <p class="text-sm {% if success %}text-green-700{% else %}text-red-700{% endif %} mt-1">
                <span id="task-status-{{ task_id }}">Checking task status...</span>
            </p>
            {% elif success and articles_count > 0 %}
            <p class="text-sm {% if success %}text-green-700{% else %}text-red-700{% endif %} mt-1">
                Stránka se automaticky obnoví za 3 sekundy...
            </p>
            {% endif %}
        </div>
    </div>
</div>

{% if success and task_id %}
<script>
    // Poll task status every 2 seconds
    const taskId = '{{ task_id }}';
    const statusElement = document.getElementById('task-status-' + taskId);

    async function checkTaskStatus() {
        try {
            const response = await fetch('/api/tasks/' + taskId);
            const task = await response.json();

            if (task.status === 'completed') {
                statusElement.innerHTML = '✅ Task completed! Scraped ' + (task.result?.articles_scraped || 0) + ' articles.';
                setTimeout(() => location.reload(), 2000);
            } else if (task.status === 'failed') {
                statusElement.innerHTML = '❌ Task failed: ' + (task.error || 'Unknown error');
            } else if (task.status === 'running') {
                statusElement.innerHTML = '🔄 Task is running...';
                setTimeout(checkTaskStatus, 2000);
            } else {
                statusElement.innerHTML = '⏳ Task is ' + task.status + '...';
                setTimeout(checkTaskStatus, 2000);
            }
        } catch (error) {
            statusElement.innerHTML = '❌ Error checking task status';
        }
    }

    // Start checking after 1 second
    setTimeout(checkTaskStatus, 1000);
</script>
{% elif success and articles_count > 0 %}
<script>
    setTimeout(function () {
        location.reload();
    }, 3000);
</script>
{% endif %}